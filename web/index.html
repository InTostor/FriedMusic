<head>
<link rel="stylesheet" href="/styles/98.css">
<link rel="stylesheet" href="/styles/main.css">
</head>

<div class="wrapper" style="display:flex;flex-direction: row;">

<div class="field-column">
  <div class="window" style="margin: 32px;position:relative;min-width:600px;max-height:100vh;">
    <div class="title-bar">
      <div class="title-bar-text">Search</div>
      <div class="title-bar-controls">
        <button aria-label="Minimize"></button>
        <button aria-label="Maximize"></button>
        <button aria-label="Close"></button>
      </div>
    </div>
    <form  id="searcher"method="post">
      <div class="field-row">
        <img src="/resources/clippy.gif">
        <div class="field-row-stacked" style="width: 400px">
          <select id="searchType"name="type">
            <option>query</option>
            <option>artist</option>
            <option>album</option>
            <option>genre</option>
          </select>
          <input id="query"name="query" type="text" >
          <!-- <input type="submit"> -->
        </div>
      </div>
    </form>
    <div id="searchRes" class="sunken-panel" style="position:relative;width:100%;height:100%;">
      <table id="searchRes">

      </table>
    </div>
  </div>
</div>



</div>

<script src="/js/lib.js"></script>
<script>
  // globals are not so bad
  
  $_GET = getUrlParams()


  let timer = null
  const searchField = document.getElementById("query")
  // re render table whe user stopped typing search query
  searchField.addEventListener('keystopped', function(event){
    clearTimeout(timer); 
    timer = setTimeout(reRenderTable(), 1000)
  }, false);


  // idk what is it
  (function(){
    var keystoppedTimer = null;
    var keystoppedInputs = document.getElementsByTagName('input');
    for (var i = 0, l = keystoppedInputs.length; i < l; i++) {
      keystoppedInputs[i].addEventListener('keydown', function(event){
        clearTimeout(keystoppedTimer);
        keystoppedTimer = setTimeout(function() {
          event.target.dispatchEvent( new Event('keystopped') );
        }, 800);
      }, false);
    }
  }());



  function reRenderTable(){
    let searchType = document.getElementById('searchType').value
    let query = document.getElementById('query').value
    let url = "/render/renderPlaylist.php?src=search&type="+searchType+"&query="+query
    // write into search.fpl
    fetch("/api/rememberSearch.php?type="+searchType+"&query="+query)


    updateUrl("/?type="+searchType+"&query="+query)
    tableHtml = fetch(url).then((response) => response.text()).then(text => {document.getElementById('searchRes').innerHTML = text})
  }


  


preventSend = function(e){e.preventDefault()}
  document.getElementById("searcher").addEventListener("submit", preventSend, true)



</script>

